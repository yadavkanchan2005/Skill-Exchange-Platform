import{_ as m}from"./preload-helper-cYIQMxwj-1.js";import{r as h}from"./stimulus-helpers-d189GC1Y-1.js";import{E as g}from"./ez-base-controller-CGJ-YSBe-1.js";import{i as p}from"./tooltips-f4Rf20ab-1.js";import{t as o}from"./helpers-AnDMAI8W-1.js";import{S as l,b as u}from"./ez-custom-events-B3OAI6ej-1.js";import{a as d}from"./ajax-helpers-CufTf_0G-1.js";import"./performance-helpers-DpsuwFL7-1.js";import"./js-Cz0CWeBA-1.js";import"./init-user-BlDnuGFC-1.js";import"./index-C4xxlH8f-1.js";import"./_commonjsHelpers-BosuxZz1-1.js";import"./modal_helpers-DIh0v7GJ-1.js";import"https://cdn.jsdelivr.net/npm/comlink/dist/esm/comlink.mjs";const T='<div class="ez-spinner ez-spinner--color-mono"></div>',i=class i extends g{constructor(){super(...arguments),this.mobileTriggerSearchByImage=()=>{this.targetTarget.click()},this.loadSearchByImageFormError=()=>{o(l)},this.clearSearchByImageDragDrop=()=>{o(u)}}connect(){p(".search-by-image__open",{extraWrapperClass:"search-by-image-trigger-tooltip"}),this.initSearchByImage()}disconnect(){this.searchByImageTooltipInitialized=!1}loadSearchByImageForm(){setTimeout(()=>{var e;(e=this.popper)!=null&&e.querySelector(".search-by-image__choose-file__url-area")?requestAnimationFrame(()=>{var t;(t=this.instanceTarget)==null||t.classList.remove("is-loading")}):d("/search_by_image_form",t=>{requestAnimationFrame(()=>{var r;this.popper.querySelector(".tippy-content").innerHTML=t.data,(r=this.instanceTarget)==null||r.classList.remove("is-loading")})},()=>{requestAnimationFrame(()=>{this.loadSearchByImageFormError()})})}),this.hasTriggerParentTarget&&requestAnimationFrame(()=>{this.triggerParentTarget.classList.add("has-search-by-image-ui")}),this.hasSearchInputTarget&&(this.backupSearchPlaceholder=this.searchInputTarget.placeholder,this.searchInputTarget.placeholder=this.placeholderValue)}hideSearchByImageForm(){var e,t;(e=this.instanceTarget)==null||e.classList.remove("is-active"),this.hasTriggerParentTarget&&this.triggerParentTarget.classList.remove("has-search-by-image-ui"),this.hasSearchInputTarget&&(this.searchInputTarget.placeholder=this.backupSearchPlaceholder),(t=this.popper)!=null&&t.querySelector(".search-by-image__choose-file__url-area")&&(this.element.removeAttribute("data-disable-form-submit"),this.clearSearchByImageDragDrop()),setTimeout(()=>{if(this.hasTriggerParentTarget){const r=this.triggerParentTarget.querySelector('[data-search-form-target="submit"]');r&&r.classList.remove("is-loading")}})}initSearchByImage(){if(!this.searchByImageTooltipInitialized){const e=this,t=this.hasTriggerParentTarget?this.triggerParentTarget:"parent";m(()=>import("./tippy-CMjLIZZA-1.js"),[],import.meta.url).then(r=>{const n=r.default;n(this.targetTargets,{content:T,allowHTML:!0,animation:"rising",interactive:!0,appendTo:t,placement:"bottom-end",theme:"search-by-image",delay:[0,null],duration:0,maxWidth:"none",offset:[0,10],trigger:"click",popperOptions:{modifiers:[{name:"flip",enabled:!1}]},onCreate(a){a.popper.classList.add("search-by-image-tooltip")},onTrigger(a,c){e.element.setAttribute("data-disable-form-submit","true"),e.urlField=a.popper.querySelector('[data-search-by-image-target="urlField"]'),e.instanceTarget=c.currentTarget,requestAnimationFrame(()=>{e.instanceTarget.classList.add("is-active")})},onShow(a){e.popper=a.popper,requestAnimationFrame(()=>{e.loadSearchByImageForm()})},onHide(a){e.popper=a.popper,requestAnimationFrame(()=>{e.hideSearchByImageForm()})}}),this.searchByImageTooltipInitialized=!0})}}};i.targets=["searchInput","triggerParent","target"],i.values={verticalOffset:Number,placeholder:String};let s=i;h([["search-by-image",s],["search-by-image-drag-drop",m(()=>import("./search-by-image-drag-drop-controller-CUeraupk-1.js"),[],import.meta.url)]]);
