var y=Object.defineProperty;var C=(n,e,t)=>e in n?y(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var h=(n,e,t)=>C(n,typeof e!="symbol"?e+"":e,t);import{C as D,r as T}from"./stimulus-helpers-d189GC1Y-1.js";import{e as i}from"./events-BT2vjsWp-1.js";import{E as l}from"./ez-base-controller-CGJ-YSBe-1.js";import{s as c,t as S,f as d,b3 as L,b4 as F,ag as B}from"./tracking-Lad8KHcD-1.js";import{X as w,D as I,Y as O,Z as P,t as A,h as E,f as x}from"./helpers-AnDMAI8W-1.js";import{a as b}from"./js-Cz0CWeBA-1.js";import"./performance-helpers-DpsuwFL7-1.js";import"./init-user-BlDnuGFC-1.js";class R extends D{constructor(){super(...arguments);h(this,"sendEvent",t=>{window.dataLayer.push({event:t.type})})}connect(){this.removeGTMListeners(),this.registerGTMListeners()}disconnect(){this.removeGTMListeners()}registerGTMListeners(){window.addEventListener(i.turbo.load,this.sendEvent,{once:!1})}removeGTMListeners(){window.removeEventListener(i.turbo.load,this.sendEvent,{once:!1})}}class V extends l{track(e){const t={action:this.trackActionValue};this.hasTrackLabelValue&&(t.label=this.trackLabelValue),this.hasTrackValueValue&&(t.value=this.trackValueValue),Object.assign(t,this.processIncludedData());const a={data:t};this.sendFromElementValue&&(a.element=e.target),c(a),w("dev")&&this.deprecationWarning(this.trackActionValue,this.element)}trackComplete(e){S({action:this.completeActionValue,category:d(e.target)}),w("dev")&&this.deprecationWarning(this.completeActionValue,this.element)}deprecationWarning(e,t){console.warn(`This tracker is deprecated. Please upgrade ${e} to use Track Event Controller or Track Complete Event Controller. Target:`,t)}processIncludedData(){if(!this.hasIncludeDataValue)return{};const e={};return this.includeDataValue.split(",").map(a=>a.trim()).forEach(a=>{e[a]=this.element.dataset[a]}),e}}h(V,"values",{trackAction:String,completeAction:String,trackLabel:String,trackValue:String,includeData:String,sendFromElement:{type:Boolean,default:!0}});const f=class f extends l{connect(){if(!this.hasActionValue)return;const e={action:this.actionValue};this.hasLabelValue&&(e.label=this.labelValue),this.hasValueValue&&(e.value=this.valueValue),Object.assign(e,this.processIncludedData());const t={data:e};this.sendFromBodyValue!==!0&&(t.element=this.element),c(t)}processIncludedData(){if(!this.hasIncludeDataValue)return{};const e={};return this.includeDataValue.split(",").map(a=>a.trim()).forEach(a=>{e[a]=this.element.dataset[a]}),e}};f.values={action:String,label:String,value:String,includeData:String,sendFromBody:{type:Boolean,default:!1}};let m=f;const v=class v extends l{connect(){if(this.hasConnectEventActionValue){const e={action:this.connectEventActionValue,sendFromBody:!1,params:null};this.track({currentTarget:this.element,params:e})}}track(e){const{action:t,label:a,value:s,sendFromBody:o=!1,...u}=e.params;if(t===void 0)return;const r={action:t};a!==void 0&&(r.label=a),s!==void 0&&(r.value=s),Object.assign(r,u),Object.assign(r,this.processIncludedData());const _={data:r};I(o)!==!0&&(_.element=e.currentTarget),c(_)}processIncludedData(){if(!this.hasIncludeDataValue)return{};const e={};return this.includeDataValue.split(",").map(a=>a.trim()).forEach(a=>{e[a]=this.element.dataset[O(a)]}),e}};v.values={includeData:String,connectEventAction:String};let g=v;class j extends l{track(e){const{action:t,category:a,label:s,value:o,...u}=e.params;if(t===void 0)return;const r={action:t};s!==void 0&&(r.label=s),o!==void 0&&(r.value=o),a===void 0?r.category=d(e.target):r.category=a,Object.assign(r,u),S(r)}}const k=class k extends l{constructor(){super(...arguments),this.sendFormFieldFocusEvent=e=>{const t=e.currentTarget.dataset.englishLabel;c({element:e.currentTarget,data:{action:L,category:d(e.currentTarget),label:`Field-${t}`}})},this.sendFormRadioChangeEvent=e=>{const t=e.currentTarget.dataset.englishLabel;c({element:e.currentTarget,data:{action:F,category:d(e.currentTarget),label:`Field-${t}`}})},this.sendFormFieldErrorEvent=e=>{const t=e.dataset.englishLabel;c({element:e,data:{action:B,label:`Field-${t}`,category:d(e),error_trigger:"Error-Submission"}})}}connect(){this.hasErrorFieldTarget&&this.errorFieldTargets.forEach(e=>{this.sendFormFieldErrorEvent(e)})}};k.targets=["errorField"];let p=k;class M extends l{connect(){}track(){const e=this.clickFormData();window.navigator.sendBeacon("/api/v2/tracking/clicks",e)}trackAnalytics(){const e=P(this.element.dataset.eventType,i);A(e,{})}clickFormData(){const e=new FormData;e.append(this.csrfParam,this.csrfToken);for(let t=0;t<this.element.attributes.length;t+=1){const a=this.element.attributes[t];if(a.name.match(/^data-/)){const s=a.name.replace("data-","").replace("-","_");["controller","action"].includes(s)||e.append(s,a.value)}}return e}normalizeParamName(e){return e.split(/(?=[A-Z])/).join("_").toLowerCase()}}class G extends D{constructor(){super(...arguments),this.sendSearchClick=e=>{const t=this.searchClickData(e);this.sendBeacon("/api/v2/tracking/search/clicks",t),window.localStorage.setItem(`resource-${e.detail.resourceId}`,JSON.stringify(t))},this.sendSponsoredSearchClick=e=>{const t=this.searchSponsoredClickData(e);this.sendBeacon("/api/v2/tracking/search/sponsored_clicks",t)},this.sendSearchDownload=e=>{const t=this.searchDownloadData(e);t&&this.sendBeacon("/api/v2/tracking/search/downloads",t)}}connect(){E()||(window.addEventListener(i.search.click,this.sendSearchClick),window.addEventListener(i.search.sponsored_click,this.sendSponsoredSearchClick),window.addEventListener(i.download_btn.initial_click,this.sendSearchDownload)),this.sendPageView()}disconnect(){window.removeEventListener(i.search.click,this.sendSearchClick),window.removeEventListener(i.search.sponsored_click,this.sendSponsoredSearchClick),window.removeEventListener(i.download_btn.initial_click,this.sendSearchDownload)}sendBeacon(e,t){if(document.body.getAttribute("data-env")==="test"){const s=b.get("searchEventsSent")||"[]",o=JSON.parse(s);o.push({url:e,data:t}),b.set("searchEventsSent",JSON.stringify(o),{domain:".example.com"});return}const a=new FormData;a.append(this.csrfParam,this.csrfToken),Object.keys(t).forEach(s=>{a.append(s,t[s])}),window.navigator.sendBeacon(e,a)}sendPageView(){x("search_tracking")&&this.isSearchResultsPage&&(E()||this.sendBeacon("/api/v2/tracking/search/pageviews",this.pageViewData))}get csrfParam(){const e=document.querySelector("meta[name=csrf-param]");return e?e.content:null}get csrfToken(){const e=document.querySelector("meta[name=csrf-token]");return e?e.content:null}get isSearchResultsPage(){return!!document.querySelector("[data-search-results-count]")}get pageViewData(){const e=["actual_free_results_shown_count","actual_pro_results_shown_count","algo_version","content_type","domain","filters_used","filter_params_json","guid","ignore","internal","locale","max_free_results_shown_count","max_pro_results_shown_count","page","pageview_guid","pro","referrer","results_count","split_test_name","split_test_variant","term","total_free_results","total_pro_results","type","user_guid","browser_language"],t={};return e.forEach(a=>{t[a]=this.element.getAttribute(`data-search-${a.replace(/_/g,"-")}`)||""}),t}searchClickData(e){const t=this.pageViewData;return t.resource_id=e.detail.resourceId,t.resource_position=e.detail.resourcePosition,t.resource_pro=e.detail.resourcePro,t}searchSponsoredClickData(e){const t=this.pageViewData;return t.resource_id=e.detail.resourceId,t.resource_position=e.detail.resourcePosition,t.resource_pro=e.detail.resourcePro,t.sponsored=e.detail.sponsored,t}searchDownloadData(e){if(!e.detail.guid)return null;const t={};return Object.entries(e.detail).forEach(([a,s])=>{t[a]=s}),t}}T([["google-tag-manager",R],["event-tracker",V],["track-trigger-event",m],["track-event",g],["track-complete-event",j],["form-analytics",p],["click-track",M],["search-analytics",G]]);
