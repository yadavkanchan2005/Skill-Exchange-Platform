import{_ as L}from"./preload-helper-cYIQMxwj-1.js";import{C as Z,r as Y}from"./stimulus-helpers-d189GC1Y-1.js";import{E as y}from"./ez-base-controller-CGJ-YSBe-1.js";import{b0 as V,s as f,J as X,t as ee,b1 as te,k as re,aw as ie,b2 as se}from"./tracking-Lad8KHcD-1.js";import{f as g,U as oe,n as ae,w as I,V as ne,W as ce,l as u,a as le,q as v,t as U,B as de,D as N}from"./helpers-AnDMAI8W-1.js";import{a as $}from"./search-helpers-CWiRuYJs-1.js";import{b as F,a as G}from"./ajax-helpers-CufTf_0G-1.js";import{d as B}from"./partner-popup-helpers-Ls47vy6L-1.js";import{a as E}from"./js-Cz0CWeBA-1.js";import{e as R}from"./events-BT2vjsWp-1.js";import{k as O,e as D,l as S}from"./ez-custom-events-B3OAI6ej-1.js";import{s as ue}from"./performance-helpers-DpsuwFL7-1.js";import he from"./init-user-BlDnuGFC-1.js";import{M as W}from"./media-matcher-vK8K0PVe-1.js";import{i as me}from"./tooltips-f4Rf20ab-1.js";import"./index-C4xxlH8f-1.js";import"./_commonjsHelpers-BosuxZz1-1.js";import"./modal_helpers-DIh0v7GJ-1.js";import"https://cdn.jsdelivr.net/npm/comlink/dist/esm/comlink.mjs";const b=class b extends y{constructor(){super(...arguments),this.gridObserver=null,this.vertGridBaseWidth=320,this.initGrid=(e=null)=>{var i,s;if(this.element.classList.contains("ez-resource-grid--partner"))return;(this.element.dataset.instantGrid!=="true"||this.element.dataset.instantGrid==="true"&&e)&&(this.element.classList.contains("ez-resource-grid--vertical")?window.masonryGrid=new window.MiniMasonry({baseWidth:this.vertGridBaseWidth,container:this.element,gutter:16,surroundingGutter:!1,wedge:!0,callback:()=>{requestAnimationFrame(()=>{this.element.classList.remove("is-hidden")})}}):(window.ezResourceGrid({gridSelector:this.element,options:{rowHeight:parseInt(this.element.getAttribute("data-row-height"),10),maxRows:parseInt(this.element.getAttribute("data-max-rows"),10),truncate:this.element.getAttribute("data-truncate-results")==="true"}}),typeof((i=window.masonryGrid)==null?void 0:i.destroy)=="function"&&((s=window.masonryGrid)==null||s.destroy()))),this.element.querySelectorAll(".ez-resource-grid__item").forEach((o,a)=>{o.setAttribute("data-position",`${a+1}`),g("thumb_preview_transition")&&this.addPrefetchHoverIntent(o)}),Array.from(document.querySelectorAll("link[rel=preload][as=image]")).map(o=>o.getAttribute("href")).forEach(o=>{const a=this.element.querySelector(`img[src="${o}"]`);a&&(a.removeAttribute("loading"),a.removeAttribute("decoding"),a.setAttribute("fetchpriority","high"))})},this.toggleGridLayout=e=>{this.element.classList.add("is-hidden");const{layout:t}=e.detail;this.gridItemTargets.forEach((r,i,s)=>{var o,a;r.removeAttribute("style"),i===s.length-1&&(t==="vert"?(this.element.classList.add("ez-resource-grid--vertical"),window.masonryGrid=new window.MiniMasonry({baseWidth:this.vertGridBaseWidth,container:this.element,gutter:16,surroundingGutter:!1,wedge:!0,callback:()=>{requestAnimationFrame(()=>{this.element.classList.remove("is-hidden")})}})):(this.element.classList.remove("ez-resource-grid--vertical"),window.ezResourceGrid({gridSelector:this.element,options:{rowHeight:parseInt(this.element.getAttribute("data-row-height"),10),maxRows:parseInt(this.element.getAttribute("data-max-rows"),10),truncate:this.element.getAttribute("data-truncate-results")==="true"},callback:()=>{setTimeout(()=>{this.element.classList.remove("is-hidden")})}}),typeof((o=window.masonryGrid)==null?void 0:o.destroy)=="function"&&((a=window.masonryGrid)==null||a.destroy())))})},this.trackResourceClick=e=>{e.currentTarget.classList.add("is-clicked"),e.currentTarget.addEventListener("mouseout",s=>{s.currentTarget.classList.remove("is-clicked")},{once:!0});const t=e.currentTarget.closest(".ez-resource-thumb"),r=t.dataset.pro==="true"?"Pro":"Free",i={action:V,label:r,content_type:`Content-${e.currentTarget.dataset.contentType}`};this.element.dataset.gridPage&&(i.value=this.gridItemIndex(t)),f({element:e.currentTarget,data:i}),r==="Free"&&B({searchTerm:this.searchTerm||E.get("most_recent_search")})},this.trackProClick=e=>{f({element:e.currentTarget,data:{action:X,category:"Grid"}}),ee({action:re,category:"Grid"})},this.trackResourceRightClick=e=>{const t=e.target.closest(".ez-resource-thumb");if(!t)return;(t.dataset.pro==="true"?"Pro":"Free")==="Free"&&B({display:!1})},this.nopeResource=e=>{e.preventDefault(),e.stopImmediatePropagation(),F("/admin/search/search_term_options/exclude",this.afterSearchTweak,()=>{},this.stoParams(this.parseResourceId(e)))},this.excludeTerm=e=>{e.preventDefault(),e.stopImmediatePropagation();const t=prompt("enter term to exclude"),r={term:this.searchTerm,locale:this.locale,content_type:this.contentType,excluded_term:t};F("/admin/search/search_term_options/exclude_term",this.afterSearchTweak,()=>{},r)},this.stoParams=e=>({term:this.searchTerm,locale:this.locale,content_type:this.contentType,resource_id:e}),this.afterSearchTweak=()=>{window.EezyScrollPositionHelper.preservePositionOnce(),window.Turbo.visit(window.location.href)},this.saveCompatibilityFilter=(e=null)=>{const t=window.filtersState.getState(),{compatibility:r}=t;this.gridItemTargets.forEach(i=>{const s=i.querySelector(".ez-resource-thumb__link");let{href:o}=s,a;r?(r.forEach(n=>{o=oe({name:"compatibility[]",value:n,url:o})}),a=o):a=ae({param:"compatibility",url:o}),s.href=a})}}get shouldTrackTruncation(){return this.hasTrackTruncationValue&&this.trackTruncationValue}connect(){this.initGrid(),window.addEventListener(O,this.initGrid),this.insertExcludeTermButton(),this.shouldTrackTruncation&&this.trackResourceTruncation(),this.element.addEventListener("contextmenu",this.trackResourceRightClick),(g("vertical_grid_2024")||I("vertical_grid_2024"))&&this.element.addEventListener("grid:toggleLayout",this.toggleGridLayout),document.querySelector('.ez-search-filters__sidebar-section[data-collapse-key="compatibility"]')&&(this.pollForFilterState(),window.addEventListener(R.search.apply_filters,this.saveCompatibilityFilter))}disconnect(){var e,t;window.removeEventListener(O,this.initGrid),this.element.removeEventListener("contextmenu",this.trackResourceRightClick),g("thumb_preview_transition")&&this.removePrefetchHoverIntent(),this.gridObserver&&this.gridObserver.disconnect(),(g("vertical_grid_2024")||I("vertical_grid_2024"))&&(this.element.removeEventListener("grid:toggleLayout",this.toggleGridLayout),typeof((e=window.masonryGrid)==null?void 0:e.destroy)=="function"&&((t=window.masonryGrid)==null||t.destroy())),document.querySelector('.ez-search-filters__sidebar-section[data-collapse-key="compatibility"]')&&window.removeEventListener(R.search.apply_filters,this.saveCompatibilityFilter)}trackResourceTruncation(){if(!this.hasGridItemTarget)return;const e=this.gridItemTargets.length,t=this.gridItemTargets.filter(i=>i.style.display==="none").length,r=ce(t,e);te({search_results_percent_hidden:r})}gridItemIndex(e){const t=parseInt(e.dataset.position,10),r=parseInt(this.element.dataset.gridPage,10),i=parseInt(this.element.dataset.perPageTotal,10);return r?(r-1)*i+t:null}insertExcludeTermButton(){if(!$())return;const e=document.querySelectorAll(".ez-resource-grid")[0],t=document.createElement("a"),r=document.createTextNode("exclude term");t.appendChild(r),t.dataset.action="click->resources-grid#excludeTerm",t.href="#",e.appendChild(t)}addPrefetchHoverIntent(e){const t=e.querySelector('[data-controller="ez-hover-intent"]');t==null||t.addEventListener(D,this.prefetchResourceAssets)}removePrefetchHoverIntent(){this.element.querySelectorAll(".ez-resource-grid__item").forEach(t=>{const r=t.querySelector('[data-controller="ez-hover-intent"]');r==null||r.removeEventListener(D,this.prefetchResourceAssets)})}prefetchResourceAssets(e){const{currentTarget:t}=e,r=JSON.parse(t.dataset.previewsSrcs||"[]"),i=this.contentType==="video"?"video":"image";r!=null&&r.length&&r.forEach(s=>{ne({src:s,asAttr:i,linkClass:"modal-show-prefetch"})})}get searchTerm(){const e=document.querySelector("[data-search-term]");return e?e.getAttribute("data-search-term"):""}get locale(){return document.documentElement.getAttribute("lang")}get contentType(){return document.querySelector(".ez-search-form__input").getAttribute("data-content-type")}parseResourceId(e){return e.target.parentNode.parentNode.dataset.itemId}pollForFilterState(){setTimeout(async()=>{if(await window.filtersState){this.saveCompatibilityFilter();return}this.pollForFilterState()},500)}};b.values={trackTruncation:Boolean},b.targets=["gridItem"];let x=b;const pe=(j="")=>`<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 30 22" role="img" class="${j}"><g clip-path="url(#a)"><rect width="28" height="20" x="1" y="1" fill="#fff" rx="10"></rect><rect width="28" height="20" x="1" y="1" fill="url(#b)" rx="10"></rect><rect width="28" height="20" x="1" y="1" fill="url(#c)" rx="10"></rect><rect width="28" height="20" x="1" y="1" fill="url(#d)" rx="10"></rect><rect width="28" height="20" x="1" y="1" fill="url(#e)" rx="10"></rect><g filter="url(#f)"><path fill="#fff" d="M10.9933 15.5H9.3058l3.0724-8.7273h1.9517L17.4066 15.5h-1.6875l-2.331-6.9375H13.32L10.9933 15.5Zm.0554-3.4219h4.6022v1.2699h-4.6022v-1.2699Zm9.0884-5.3054V15.5h-1.581V6.7727h1.581Z"></path></g><rect width="27" height="19" x="1.5" y="1.5" stroke="#fff" stroke-opacity=".5" rx="9.5"></rect></g><rect width="29" height="21" x=".5" y=".5" stroke="#000" stroke-opacity=".2" rx="10.5"></rect><defs><radialGradient id="b" cx="0" cy="0" r="1" gradientTransform="rotate(-144.462 18.9402 6.1978) scale(25.807 23.1851)" gradientUnits="userSpaceOnUse"><stop stop-color="#3E74FF"></stop><stop offset="1" stop-color="#3E74FF" stop-opacity="0"></stop></radialGradient><radialGradient id="c" cx="0" cy="0" r="1" gradientTransform="matrix(-19.83329 14.1668 -13.40102 -18.7612 29 1.4167)" gradientUnits="userSpaceOnUse"><stop stop-color="#F846C2"></stop><stop offset="1" stop-color="#F846C2" stop-opacity="0"></stop></radialGradient><radialGradient id="d" cx="0" cy="0" r="1" gradientTransform="matrix(21.00001 15.00002 -14.1892 19.86486 1 1)" gradientUnits="userSpaceOnUse"><stop stop-color="#FF9052"></stop><stop offset="1" stop-color="#FF9052" stop-opacity="0"></stop></radialGradient><radialGradient id="e" cx="0" cy="0" r="1" gradientTransform="matrix(17.18588 -12.27564 11.6121 16.25693 .1474 24.9423)" gradientUnits="userSpaceOnUse"><stop stop-color="#32B8CE"></stop><stop offset="1" stop-color="#32B8CE" stop-opacity="0"></stop></radialGradient><clipPath id="a"><rect width="28" height="20" x="1" y="1" fill="#fff" rx="10"></rect></clipPath><filter id="f" width="14.8313" height="12.7273" x="7.3058" y="4.7727" color-interpolation-filters="sRGB" filterUnits="userSpaceOnUse"><feFlood flood-opacity="0" result="BackgroundImageFix"></feFlood><feColorMatrix in="SourceAlpha" result="hardAlpha" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"></feColorMatrix><feOffset></feOffset><feGaussianBlur stdDeviation="1"></feGaussianBlur><feComposite in2="hardAlpha" operator="out"></feComposite><feColorMatrix values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0"></feColorMatrix><feBlend in2="BackgroundImageFix" result="effect1_dropShadow_56_700"></feBlend><feBlend in="SourceGraphic" in2="effect1_dropShadow_56_700" result="shape"></feBlend></filter></defs></svg>`,_=class _ extends y{constructor(){super(...arguments),this.disableTurbo=()=>{this._decorateGridItem({elem:this.element,conditional:this._disableTurbo(),effect:e=>{e.querySelector(".ez-resource-thumb__link").setAttribute("data-turbo","false")}})},this.addEditableLabels=()=>{this._decorateGridItem({elem:this.element,conditional:this._addEditableLabels(),effect:e=>{const t=e.querySelector(".ez-resource-thumb__label-wrap"),r=`
          <div class="ez-resource-thumb__label-wrap__editable-label">${this.editableLabelValue}</div>`;this._appendHTML(t,r)}})},this.addEventLabels=()=>{this._decorateGridItem({elem:this.element,conditional:this._addEventLabels(),effect:e=>{const t=e.querySelector(".ez-resource-thumb__label-wrap"),i=`
        <div class="ez-resource-thumb__label-wrap__event">
          ${this.element.dataset.gridItemDecoratorEventDateParam?`<div class="ez-resource-thumb__label-wrap__event__date">${this.element.dataset.gridItemDecoratorEventDateParam}</div>`:""}
          <div class="ez-resource-thumb__label-wrap__event__description">${this.element.dataset.gridItemDecoratorEventDescriptionParam}</div>
        </div>`;this._appendHTML(t,i)}})},this.addEventMobileHover=()=>{this._decorateGridItem({elem:this.element,conditional:this._addEventMobileHover(),effect:e=>{const r=document.querySelector('[data-grid-item-decorator-target="hoverTemplate"]').innerHTML.trim(),i=e.querySelector(".ez-resource-thumb__hover-state"),s={eventNumberImages:this.element.dataset.gridItemDecoratorEventNumberImagesParam};requestAnimationFrame(()=>{i.insertAdjacentHTML("beforeend",u(r,s))})}})},this.addFreeLabels=()=>{this._decorateGridItem({elem:this.element,conditional:this._addFreeLabels(),effect:e=>{const t=e.querySelector(".ez-resource-thumb__label-wrap"),r=`
          <div class="ez-resource-thumb__label-wrap__free-label">${this.freeLabelValue}</div>`;this._appendHTML(t,r)}})},this.addAiLabels=()=>{const e="ez-resource-thumb__label-wrap__ai-label",t=pe(e);this._decorateGridItem({elem:this.element,conditional:this._addAiLabels(e),effect:r=>{const i=r.querySelector(".ez-resource-thumb__label-wrap");this._appendHTML(i,t)}})},this.insertSearchDeboostingButtons=()=>{if(!this.hasLinkTarget)return;const e=`
      <div class="ez-resource-thumb__link__admin ez-resource-thumb__link__admin--nope"
            data-action="click->resources-grid#nopeResource">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18.83 18.83">
          <path d="M18.83 2.83L16 0 9.41 6.59 2.83 0 0 2.83l6.59 6.58L0 16l2.83 2.83 6.58-6.59L16 18.83 18.83 16l-6.59-6.59 6.59-6.58z"/>
        </svg>
      </div>
    `;this._decorateGridItem({elem:this.linkTarget,conditional:this._insertSearchDeboostingButtons(),effect:t=>{this._appendHTML(t,e)}})},this.addRemoveFromCollectionAction=()=>{const e=this.element.closest(".ez-resource-grid"),t=e==null?void 0:e.querySelector("#removeFromCollectionTemplate"),r=this.element.querySelector(".ez-resource-thumb__hover-state");this._decorateGridItem({elem:this.element,conditional:this._addRemoveFromCollectionAction()&&!!t&&!!r,effect:i=>{this._injectRemoveButton(i,t,r)}})},this.addCollectionDragHandle=()=>{const e=`
      <div class="ez-resource-thumb__grab__wrapper is-hidden" draggable="true">
        <svg viewBox="0 0 9.8 14" xmlns="http://www.w3.org/2000/svg">
          <g opacity=".74"><circle cx="1.5" cy="1.5" r="1.5"/>
          <circle cx="1.5" cy="7" r="1.5"/><circle cx="1.5" cy="12.5" r="1.5"/>
          <circle cx="8.3" cy="1.5" r="1.5"/><circle cx="8.3" cy="7" r="1.5"/>
          <circle cx="8.3" cy="12.5" r="1.5"/></g>
        </svg>
      </div>
    `;this._decorateGridItem({elem:this.element,conditional:this.element.hasAttribute("data-collection-item-id"),effect:t=>{this._appendHTML(t,e)}})},this._decorateGridItem=({elem:e,conditional:t,effect:r})=>{t&&e&&r(e)}}connect(){this.contentType=document.body.dataset.conversionsContentType||le(),ue(["disableTurbo","addFreeLabels","addEventLabels","addEventMobileHover","addAiLabels","addEditableLabels","insertSearchDeboostingButtons","addRemoveFromCollectionAction","addCollectionDragHandle"],this)}hoverThumb({currentTarget:e,params:t}){document.body.classList.contains("is-mobile")&&v()||this._decorateGridItem({elem:e,conditional:this._showHoverOverlay(e),effect:r=>{const{userId:i,userDisplayName:s,avatarSrc:o,uploadsPath:a,contentType:n,itemPro:h,imageSrc:m,pinterestUrl:T,title:w,resourceId:Q}=t;let d=document.querySelector('[data-grid-item-decorator-target="hoverTemplate"]').innerHTML.trim();if(!i){const c=this._removeFromHoverAction({hoverTemplateHtml:d,selector:".ez-resource-thumb__name-content__wrapper"});c&&(d=c)}if(e.dataset.gridItemDecoratorContentTypeParam==="Content-editorial_image"){let c=this._removeFromHoverAction({hoverTemplateHtml:d,selector:".resource-action-button--similar-images"});c=this._removeFromHoverAction({hoverTemplateHtml:c,selector:".resource-action-button--pinterest"}),c&&(d=c)}d=u(d,{user_id:i,user_display_name:s,contributor_avatar_src:o,contributor_uploads_path:a,content_type:n,item_pro:h,image_src:m,pinterest_url:T,title:w,id:Q,url:a,src:o});const J=r.querySelector(".ez-resource-thumb__hover-state");requestAnimationFrame(()=>{if(J.insertAdjacentHTML("beforeend",d),o){const c={src:o},K=r.querySelector('[data-template="avatar-template"]').innerHTML.trim(),M=r.querySelector(".ez-avatar");requestAnimationFrame(()=>{M.classList.remove("ez-avatar--missing"),M.innerHTML=u(K,c)})}U(S)})}})}hoverEventThumb({currentTarget:e,params:t}){document.body.classList.contains("is-mobile")&&v()||this._decorateGridItem({elem:e,conditional:this._showHoverOverlay(e),effect:r=>{const s=document.querySelector('[data-grid-item-decorator-target="hoverTemplate"]').innerHTML.trim(),o=r.querySelector(".ez-resource-thumb__hover-state");requestAnimationFrame(()=>{o.insertAdjacentHTML("beforeend",u(s,t))})}})}_removeFromHoverAction({hoverTemplateHtml:e,selector:t}){const r=document.createElement("DIV");r.innerHTML=e;const i=r.querySelector(t);return i?(i.remove(),r.innerHTML):e}_appendHTML(e,t){e&&requestAnimationFrame(()=>{e.insertAdjacentHTML("beforeend",t)})}_injectRemoveButton(e,t,r){const{collectionItemId:i,pro:s}=e.dataset,o=e.querySelector(".ez-resource-thumb__link"),{contentType:a}=o.dataset;if(!i)return;let n=t.innerHTML.trim();n=u(n,{item_id:i,content_type:`Content-${a}`,item_pro:s?"Pro":"Free"}),requestAnimationFrame(()=>{r.insertAdjacentHTML("beforeend",n)})}_showHoverOverlay(e){return!(e.classList.contains("ez-resource-thumb--sponsored")||document.body.classList.contains("is-mobile")&&v())}_addAiLabels(e){return!(this.element.querySelector(`.${e}`)||!this.hasAiLabelValue)}_addEditableLabels(){if(this.element.querySelector(".ez-resource-thumb__label-wrap__editable-label")||!this.hasEditableLabelValue)return!1;const i=["vector"].includes(this.contentType);return de()&&i}_addEventLabels(){return!(this.element.querySelector(".ez-resource-thumb__label-wrap__event-label")||!this.element.dataset.gridItemDecoratorEventDescriptionParam)}_addEventMobileHover(){if(!document.body.classList.contains("is-mobile")||!v())return!1;const e=this.element.querySelector('.ez-resource-thumb__link[data-content-type="editorial_event"]');return!(this.element.querySelector(".ez-resource-thumb__hover-state__event")||!e)}_disableTurbo(){return!!this.element.querySelector('.ez-resource-thumb__link[data-content-type="editorial_event"]')}_addFreeLabels(){if(this.element.querySelector(".ez-resource-thumb__label-wrap__free-label")||!this.hasFreeLabelValue)return!1;const r=!he.isPro,i=!N(this.element.dataset.pro);return r&&i}_insertSearchDeboostingButtons(){return this.element.querySelector(".ez-resource-thumb__link__admin--nope")?!1:this.element.closest(".ez-search-results")&&$()}_addRemoveFromCollectionAction(){return!this.element.querySelector(".ez-resource-thumb__remove")}};_.targets=["link"],_.values={freeLabel:String,editableLabel:String,aiLabel:String};let P=_;const l=new W,z=class z extends y{constructor(){super(...arguments),this.setNewThumbnailInfo=()=>{this.setupContribInfoTooltips()},this.reinitializeContribTooltips=()=>{this.tooltipsInitialized=!1,l.addMediaQuery("(min-width: 1024px)",this.initTooltips),l.evaluateAll(),l.addListeners()},this.initTooltips=()=>{if(!this.tooltipsInitialized){const e=this.element.querySelectorAll('.resource-action-button[data-ez-tooltip="true"]:not(.is-tipped)');e.length&&me(e);const t=this,r=this.element.querySelectorAll('[data-resources-grid-target="nameTarget"]:not(.is-tipped)'),i='<div class="ez-spinner ez-spinner--sm ez-spinner--color-mono"></div>';L(()=>import("./tippy-CMjLIZZA-1.js"),[],import.meta.url).then(s=>{const o=s.default;o(r,{content:i,allowHTML:!0,animation:"rising",interactive:!0,appendTo:document.body,placement:"bottom-start",theme:"contrib-info",delay:[250,null],duration:0,onCreate(a){a.popper.classList.add("contributor-info-tooltip")},onShow(a){t.tippyInstance=a,t.showTooltip(),a.popper.addEventListener("mouseleave",t.stopPreviewVideo)},onHide(a){t.tippyInstance=a,t.hideTooltip(),a.popper.removeEventListener("mouseleave",t.stopPreviewVideo)}}),this.tooltipsInitialized=!0}),r.forEach(s=>{s.classList.add("is-tipped")})}},this.stopPreviewVideo=e=>{const t=this.getParentLi(this.tippyInstance.reference);e.relatedTarget&&!this.newTargetIsPreview(e.relatedTarget)&&t.classList.remove("is-playing")},this.injectTooltipContent=()=>{if(this.contributorsInfo||this.pageGrids.length>1){clearInterval(this.contributorsInfoPolling);const e=this.contribInfoTemplateTarget.innerHTML,t=this.parseTemplateForContributor(e);setTimeout(()=>{this.initTooltipContent(t)},0)}},this.clickThroughToProfile=e=>{this.trackContributorClick(e)}}connect(){I("remove_contrib_hover_cards")||(this.hasContribInfoTemplateTarget&&this.contributorsIds.length&&this.setupMediaQueries(),this.hasContribThumbnailsTarget&&this.setupFollowingThumbnails(),l.evaluateAll(),l.addListeners(),window.addEventListener(S,this.reinitializeContribTooltips))}disconnect(){l.removeListeners(),l.clearQueries(),window.removeEventListener(S,this.reinitializeContribTooltips)}setupContribInfoTooltips(){this.pageGrids=document.querySelectorAll('[data-controller~="resources-grid"]:not(.ez-resource-grid--partner)');const e=document.querySelector(".ez-page-wrapper");this.contributorsIds&&((!this.hasIdCollectionTarget||this.idCollectionTarget.dataset.featuredGrid==="0")&&G("/async_contributors_info",t=>{this.contributorsInfo=t.data;const r=e?JSON.parse(e.getAttribute("data-contributors-info")):{},i={...t.data,...r};this.pageGrids.length>=1&&e&&e.setAttribute("data-contributors-info",JSON.stringify(i))},t=>{console.error(t)},{params:{contributor_ids:this.contributorsIds,preview_count:3}}),this.reinitializeContribTooltips())}setupFollowingThumbnails(){G("/async_contributors_info",e=>{this.contributorsInfo=e.data,this.gatherfollowedUsers().forEach(t=>{const r=document.querySelector(`[data-user-id="${t}"] [data-thumbnail-contributor-info-target="previewsWrap"]`),i=this.contributorsInfo[t].previews;let s="";i.forEach(o=>{const{thumb_src:a,thumb_src_2x:n,resource_path:h,resource_title:m,content_type:T,pro:w}=o;s+=this.makePreviewThumbHTML(a,n,h,m,T,w)}),r.innerHTML=s})},e=>{console.error(e)},{params:{contributor_ids:this.gatherfollowedUsers(),preview_count:3,sort:"recent"}})}get contributorsIds(){return this.hasContribInfoTemplateTarget?JSON.parse(this.contribInfoTemplateTarget.dataset.userIds):null}gatherfollowedUsers(){const e=[];return this.contribThumbnailsTargets.forEach(t=>{e.push(t.dataset.userId)}),e}showTooltip(){this.contributorsInfoPolling=setInterval(this.injectTooltipContent,100),this.injectTooltipContent()}hideTooltip(){clearInterval(this.contributorsInfoPolling),this.getParentLi(this.tippyInstance.reference).classList.remove("is-hovered")}newTargetIsPreview(e){return!(!e.hasAttribute("data-video-preview-target")||e.getAttribute("data-video-preview-target")!=="videoWrap")}initTooltipContent(e){const t=this.getTooltipContent(this.tippyInstance.popper),r=this.getParentLi(this.tippyInstance.reference);t.innerHTML=e,this.fixAvatar(),this.loadPreviewThumbs(),this.hideCountIfNull(),r.classList.add("is-hovered")}parseTemplateForContributor(e){const t=this.contributorInfoById;return t.url=t.contributor_uploads_path,t.src=t.contributor_avatar_src,u(e,t)}fixAvatar(){const e=this.getTooltipContent(this.tippyInstance.popper),t=e.querySelector(".ez-avatar"),r=e.querySelector('[data-thumbnail-contributor-info-target="avatarTemplate"]');this.contributorInfoById.contributor_avatar_src&&(t.classList.remove("ez-avatar--missing"),t.innerHTML=r.innerHTML)}hideCountIfNull(){const t=this.getTooltipContent(this.tippyInstance.popper).querySelector(".contributor-details__contributor__count");this.contributorInfoById.contributor_resource_count||t.classList.add("is-hidden")}loadPreviewThumbs(){const e=this.contributorInfoById.previews,t=this.tippyInstance.popper.querySelector('[data-thumbnail-contributor-info-target="previewsWrap"]');let r="";e.forEach(i=>{const{thumb_src:s,thumb_src_2x:o,resource_path:a,resource_title:n,pro:h,content_type:m}=i;r+=this.makePreviewThumbHTML(s,o,a,n,m,h)}),t.innerHTML=r}makePreviewThumbHTML(e,t,r,i,s,o){return`<a href="${r}"
               class="ez-resource-grid__item__contrib-info__uploads__thumb"
               data-content-type="${s}"
               data-pro="${o}"
               data-action="click->thumbnail-contributor-info#trackResourceClick">
              <img src="${e}"
                   srcset="${t} 2x, ${e} 1x" alt="${i}"></a>
              `}get contributorInfoById(){var s;const e=document.querySelector(".ez-page-wrapper"),t=e&&e.hasAttribute("data-contributors-info")?JSON.parse(e.getAttribute("data-contributors-info")):{},r=this.tippyInstance.reference.getAttribute("data-user-id");if((s=this.contributorsInfo)!=null&&s[r]&&t[r]){const o=t[r].contributor_uploads_path;this.contributorsInfo[r]=t[r],this.contributorsInfo[r].url=o}return{...t,...this.contributorsInfo||{}}[r]}getParentLi(e){return e.closest(".ez-resource-thumb")}trackContributorClick(e){f({element:e.target||e.currentTarget,data:{action:ie}})}trackResourceClick(e){const{contentType:t,pro:r}=e.target.dataset;f({element:e.target,data:{action:V,label:N(r)?"Pro":"Free",content_type:`Content-${t}`}})}getTooltipHeader(e){return e.querySelector(".tippy-box[data-theme=contrib-info] .contributor-details__contributor")}getTooltipContent(e){return e.querySelector(".tippy-content")}setupMediaQueries(){l.addMediaQuery("(min-width: 1024px)",()=>{this.contributorsIds.length&&this.setupContribInfoTooltips()})}};z.targets=["contribInfoTemplate","contribThumbnails","idCollection","avatarTemplate"];let C=z;const p=new W,k=class k extends Z{constructor(){super(...arguments),this.videoSelector='[data-video-preview-target*="preview"]',this.addPreviewEvents=()=>{this.previewTargets.forEach(e=>{e.addEventListener("mouseenter",this.playVideo,!1),e.addEventListener("mouseleave",this.maybePauseVideo,!1)})},this.removePreviewEvents=()=>{this.previewTargets.forEach(e=>{e.removeEventListener("mouseenter",this.playVideo),e.removeEventListener("mouseleave",this.maybePauseVideo)})},this.pauseHiddenVideos=e=>{this.element.querySelectorAll("video").forEach(r=>{r!==e.target&&this.pauseVideo(r,!0)})},this.playVideo=e=>{e.stopPropagation();const t=e.currentTarget;t.querySelector("video")||this.addVideoToDOM(t),this.videoPlayIntent=setTimeout(()=>{const r=t.querySelector("video"),i=r.play();i!==void 0&&i.then(()=>{r.loop=!0,r.readyState>=3&&t.classList.add("is-playing")})},150)},this.maybePauseVideo=e=>{clearTimeout(this.videoPlayIntent);const t=e.currentTarget.querySelector("video");t&&!t.closest(this.videoSelector).classList.contains("is-hovered")&&this.pauseVideo(t,!0)}}connect(){if(!this.hasPreviewTarget)return!1;this.setupPreviewMediaQueries(),document.addEventListener("play",this.pauseHiddenVideos,!0),p.evaluateAll(),p.addListeners()}disconnect(){this.removeListeners(),p.removeListeners(),p.clearQueries()}removeListeners(){document.removeEventListener("play",this.pauseHiddenVideos),this.removePreviewEvents()}addVideoToDOM(e){const{videoUrl:t}=e.dataset,r=`<div class="video-wrapper">
                        <video autoplay="true" preload="none" muted playsinline>
                          <source src="${t}" type="video/mp4">
                        </video>
                      </div>`;e.querySelector('[data-video-preview-target*="videoWrap"]').insertAdjacentHTML("beforeend",r)}isPlaying(e){return e.currentTime>0&&!e.paused&&!e.ended&&e.readyState>2}pauseVideo(e,t=!1){if(e&&this.isPlaying(e)){e.closest(this.videoSelector).classList.remove("is-playing"),e.pause();const r=e.querySelector("source"),i=r.src;r.src="",r.removeAttribute("src"),e.load(),r.src=i,e.pause(),t&&(e.currentTime=0)}}setupPreviewMediaQueries(){p.addMediaQuery("(min-width: 1024px)",()=>{this.addPreviewEvents()},()=>{this.removePreviewEvents()})}};k.targets=["preview"];let A=k;const q=class q extends y{toggleLayout(e){this.toggleButtonTargets.forEach(i=>{i.classList.remove("is-active")}),e.currentTarget.classList.add("is-active");const t=document.querySelector(".ez-resource-grid--main-grid"),{layout:r}=e.params;E.set("search_grid_layout",r),t&&U("grid:toggleLayout",{layout:r},t),E.remove("vertical_search_grid_default"),f({element:e.currentTarget,data:{action:se,label:r}})}};q.targets=["toggleButton"];let H=q;Y([["grid-item-decorator",P],["resources-grid",x],["thumbnail-contributor-info",C],["video-preview",A],["grid-layout",H],["pinterest-share",L(()=>import("./pinterest-share-controller-YXaylgZW-1.js"),[],import.meta.url)],["ez-hover-intent",L(()=>import("./ez-hover-intent-controller-C9WospQ6-1.js"),[],import.meta.url)]]);
