var T=Object.defineProperty;var m=(o,e,t)=>e in o?T(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var i=(o,e,t)=>m(o,typeof e!="symbol"?e+"":e,t);import{r as v}from"./stimulus-helpers-d189GC1Y-1.js";import{F as w}from"./filters-sidebar-controller-BjLDiiSu-1.js";import{E as p}from"./ez-base-controller-CGJ-YSBe-1.js";import{_ as x}from"./preload-helper-cYIQMxwj-1.js";import{a as l,t as h,c as g}from"./helpers-AnDMAI8W-1.js";import{e as C}from"./events-BT2vjsWp-1.js";import{s as S,c as k}from"./tracking-Lad8KHcD-1.js";import"./performance-helpers-DpsuwFL7-1.js";import"./filters-state-Bf8bgq7q-1.js";import"./media-matcher-vK8K0PVe-1.js";import"./tooltips-f4Rf20ab-1.js";import"./js-Cz0CWeBA-1.js";import"./init-user-BlDnuGFC-1.js";import"./dates--ZzK0_Rp-1.js";class u extends p{constructor(){super(...arguments);i(this,"rangeChange",()=>{const t=parseFloat(this.rangeATarget.value),s=parseFloat(this.rangeBTarget.value),r=t<=s?t:s,a=t>s?t:s,f=(r-this.rangeMin)/this.rangeBasis*100;this.activeTrackTarget.style.left=`${f}%`;const d=(this.rangeMax-a)/this.rangeBasis*100;this.activeTrackTarget.style.right=`${d}%`,this.selectedMaxRange(d),this.setRangeDisplay(r,a)});i(this,"selectedMaxRange",t=>t===0?this.element.classList.add("selected-max-range"):this.element.classList.remove("selected-max-range"));i(this,"setRangeDisplay",(t,s)=>{this.displayLeftTarget.innerHTML=t,this.displayRightTarget.innerHTML=s})}connect(){this.rangeMin=this.rangeATarget.min,this.rangeMax=this.rangeATarget.max,this.rangeBasis=this.rangeMax-this.rangeMin,this.rangeChange()}}i(u,"targets",["rangeA","rangeB","activeTrack","displayLeft","displayRight"]);class W extends u{constructor(){super(...arguments);i(this,"setRangeDisplay",(t,s)=>{this.displayLeftTarget.innerHTML=this.displaySecondsAsMinutes(t),this.displayRightTarget.innerHTML=this.displaySecondsAsMinutes(s)});i(this,"displaySecondsAsMinutes",t=>{const s=Math.floor(t%60),r=s<10?`0${s}`:s;return`${Math.floor(t/60)}:${r}`})}connect(){super.connect(),this.element.addEventListener("input",this.rangeChange),this.element.addEventListener("change",this.rangeChange)}disconnect(){super.disconnect(),this.element.removeEventListener("input",this.rangeChange),this.element.removeEventListener("change",this.rangeChange)}}const c=class c extends p{constructor(){super(...arguments),this.filterEvents=[],this.vectorProps={min:10,max:40,default:14},this.photoProps={min:20,max:50,default:24},this.hexTextChange=()=>{let e=this.hexTextTarget.value.replace(/^#/,"");const t=this.colorSwatchTarget.dataset.lastColor?this.colorSwatchTarget.dataset.lastColor:null;switch(e.length){case 1:e=e.repeat(6);break;case 2:e=e.repeat(3);break;case 3:e=e.repeat(2);break;case 4:e+=e.substring(0,2);break;case 5:e+=e.substring(0,1);break}this.isValidHex(e)?(this.colorWheel.color.hexString=`#${e}`,this.hexTextTarget.value=`#${e}`,this.colorChangeCallback(e)):t?(this.colorWheel.color.hexString=t,this.hexTextTarget.value=t):this.colorReset()},this.colorChangeCallback=e=>{const t=e.hexString?e.hexString.replace(/#(?=\S)/g,""):e.replace(/#(?=\S)/g,"");this.addSwatchToEzSearchForm(t);const s=this.hexTextTarget.closest(".ez-input--animated-label");s==null||s.classList.add("is-focused"),this.hexTextTarget.value=`#${t}`,this.element.dataset.lastColor=t,this.colorSwatchTarget.style.backgroundColor=`#${t}`,this.colorSwatchTarget.classList.add("color-filter-options__swatch--active"),window.filtersState.getRawStateObject().color_tolerance===""&&this.setFilter("color_tolerance",`color_tolerance-${this.getDefaultThreshold()}`,"update",!1),this.setFilter("color",`color-${t}`)},this.setColorWheelWidth=()=>{this.colorWheel.setState({width:this.getColorWheelWidth()})},this.setupThreshold=()=>{const e=window.filtersState.getRawStateObject(),t=this.vectorProps,s=this.photoProps;let r=e.color_tolerance?e.color_tolerance:this.getDefaultThreshold();l()==="vector"?r=this.calculateThreshold(r,t.min,t.max):r=this.calculateThreshold(r,s.min,s.max),this.rangeATarget.value=r,this.activeTrackTarget.style.width=`${r}%`,this.updateColorWheelPicker(r)},this.handleSlider=e=>{const t=e.target;this.activeTrackTarget.style.width=`${t.value}%`,this.updateColorWheelPicker(t.value)},this.updateColorWheelPicker=e=>{const t=15+.23*e,s=16+19/100*e;this.colorWheel.setState({sliderMargin:s,activeHandleRadius:t})},this.setThreshold=e=>{const t=this.vectorProps,s=this.photoProps,r=e.target;let a;l()==="vector"?a=this.calculateThresholdOffset(r.value,t.min,t.max,!0):a=this.calculateThresholdOffset(r.value,s.min,s.max,!0),this.setFilter("color_tolerance",`color_tolerance-${a}`)},this.colorReset=()=>{const e=window.filtersState.getRawStateObject(),{lastColor:t}=this.colorSwatchTarget.dataset;this.colorWheel.reset(),this.hexTextTarget.value="";const s=this.hexTextTarget.closest(".ez-input--animated-label");s==null||s.classList.remove("is-focused"),this.colorSwatchTarget.style.backgroundColor="#ffffff",this.colorSwatchTarget.classList.remove("color-filter-options__swatch--active"),t&&this.setFilter("color",`color-${t}`,"remove"),e.color_tolerance&&this.setFilter("color_tolerance",`color_tolerance-${e.color_tolerance}`,"remove")},this.isValidHex=e=>{if(!e||typeof e!="string")return!1;switch(e.length){case 6:return/^[0-9A-F]{6}$/i.test(e);default:return!1}},this.setFilter=(e="color",t="",s="update",r=!0)=>{if(s==="remove")window.filtersState.removeParamKey(t);else if(window.filtersState.updateParamKey(t),r){const a={action:k,label:`Filter-${e}`,filter_selection:`Filter-${t}`};this.filterEvents.push(a),S({data:a})}this.applyFilters()},this.applyFilters=()=>{h(C.search.apply_filters,{contentType:l()}),g()<750&&h("search:apply_mobile_color_filter")},this.addSwatchToEzSearchForm=e=>{h("updateEzSearchFormColorSwatch",{color:e})}}connect(){x(()=>import("./iro-DnhVHy6d-1.js"),[],import.meta.url).then(e=>{requestIdleCallback(()=>{this.setupColorWheel(e),this.setupThreshold(),this.colorWheel.on("mount",this.setPickerBkg),this.colorWheel.on("input:end",this.colorChangeCallback),window.addEventListener("resize",this.setColorWheelWidth),window.addEventListener("resetColorSwatchFilter",this.colorReset),this.hexTextTarget.addEventListener("change",this.hexTextChange),this.flagLoaded()})})}disconnect(){window.removeEventListener("resize",this.setColorWheelWidth),window.removeEventListener("resetColorSwatchFilter",this.colorReset),this.colorWheel.off("mount",this.setPickerBkg),this.colorWheel.off("input:end",this.colorChangeCallback),this.hexTextTarget.removeEventListener("change",this.hexTextChange)}setupColorWheel({default:e}){const t=window.filtersState.getRawStateObject(),s=t.color?t.color:"#d4d4d4";this.colorWheel=new e.ColorPicker(".color-filter-options__color-wheel",{width:this.getColorWheelWidth(),display:"block",sliderMargin:16,wheelAngle:60,padding:3,color:s})}setPickerBkg(){const e=document.querySelector(".IroWheel .IroHandle");if(!e)return;const t=e.children[1];t.style.fillOpacity="0"}getColorWheelWidth(){return g()>750?208:269}calculateThreshold(e,t,s){return Math.round((e-t)/(s-t)*100)}getDefaultThreshold(){return l()==="vector"?this.vectorProps.default:this.photoProps.default}calculateThresholdOffset(e,t,s,r=!1){return r?Math.round(t+(s-t)/100*e):t+(s-t)/100*e}};c.targets=["activeTrack","hexText","colorSwatch","slash","rangeA"];let n=c;v([["filters-sidebar",w],["duration-range",W],["color-filter",n]]);
